# 6. Maintenance Mode

## Features Overview

The maintenance mode feature allows you to temporarily disable file uploads and display a custom maintenance message to users while keeping existing download links functional.

## Enabling Maintenance Mode

### Via Web Interface

1. Log in to the admin panel
2. Navigate to **Settings** > **Maintenance**
3. Toggle **Enable Maintenance Mode**
4. Set custom maintenance message (optional)
5. Click **Save Changes**

### Via Command Line

```bash
# Enable maintenance mode
php artisan down

# Enable with custom message
php artisan down --message="We're performing scheduled maintenance"

# Enable with retry time (in seconds)
php artisan down --retry=60

# Enable with allowed IPs
php artisan down --allow=127.0.0.1 --allow=192.168.1.1
```

### Via Environment Variable

```env
MAINTENANCE_MODE=true
MAINTENANCE_MESSAGE="We're currently performing maintenance. Please try again later."
```

## Maintenance Mode Behavior

### What's Disabled

- ✗ New file uploads
- ✗ File deletion
- ✗ Admin panel access (except for authorized IPs)
- ✗ API endpoints (except file downloads)

### What Remains Active

- ✅ File downloads (existing links work)
- ✅ File previews
- ✅ File information pages
- ✅ Static assets and pages

## Custom Maintenance Page

### Default Maintenance Page

The system displays a clean, branded maintenance page with:

- Custom maintenance message
- Estimated downtime (if provided)
- Contact information
- Retry-after header for proper HTTP behavior

### Customizing the Maintenance Page

1. **Edit the maintenance view:**
   ```bash
   resources/views/maintenance.blade.php
   ```

2. **Custom CSS styling:**
   ```css
   .maintenance-container {
       background: linear-gradient(135deg, #ff6b35, #f7931e);
       min-height: 100vh;
       display: flex;
       align-items: center;
       justify-content: center;
   }
   ```

3. **Add custom JavaScript:**
   ```javascript
   // Auto-refresh every 5 minutes
   setTimeout(() => {
       window.location.reload();
   }, 300000);
   ```

## Scheduled Maintenance

### Planning Maintenance Windows

1. **Announce in advance:**
   - Update website banner
   - Send notifications (if applicable)
   - Post on social media

2. **Choose optimal timing:**
   - Low traffic periods
   - Consider global user base
   - Avoid peak usage hours

3. **Prepare maintenance checklist:**
   - [ ] Backup database
   - [ ] Backup files
   - [ ] Test maintenance page
   - [ ] Prepare rollback plan

### Maintenance Checklist

#### Pre-Maintenance

- [ ] Enable maintenance mode
- [ ] Verify maintenance page displays correctly
- [ ] Test that downloads still work
- [ ] Notify users (if applicable)
- [ ] Create database backup
- [ ] Create file system backup

#### During Maintenance

- [ ] Perform necessary updates
- [ ] Run database migrations
- [ ] Clear caches
- [ ] Test functionality
- [ ] Verify file integrity

#### Post-Maintenance

- [ ] Disable maintenance mode
- [ ] Test all functionality
- [ ] Monitor error logs
- [ ] Verify performance
- [ ] Update status page

## Disabling Maintenance Mode

### Via Command Line

```bash
# Disable maintenance mode
php artisan up
```

### Via Web Interface

1. Access admin panel (if allowed IP)
2. Navigate to **Settings** > **Maintenance**
3. Toggle **Disable Maintenance Mode**
4. Click **Save Changes**

### Emergency Disable

If you're locked out, you can disable maintenance mode by:

1. **Delete maintenance file:**
   ```bash
   rm storage/framework/maintenance.php
   ```

2. **Set environment variable:**
   ```env
   MAINTENANCE_MODE=false
   ```

## Monitoring During Maintenance

### Log Monitoring

```bash
# Monitor application logs
tail -f storage/logs/laravel.log

# Monitor web server logs
tail -f /var/log/nginx/access.log
```

### Health Checks

```bash
# Check if maintenance mode is active
php artisan tinker
>>> app()->isDownForMaintenance()
```

### User Impact Monitoring

- Monitor download success rates
- Check for increased error rates
- Verify maintenance page loads correctly
- Test from different geographic locations

## Best Practices

### Communication

- **Be transparent:** Clearly communicate what's happening
- **Set expectations:** Provide estimated completion time
- **Regular updates:** Update users on progress
- **Contact information:** Provide support contact details

### Technical

- **Test thoroughly:** Always test maintenance mode before using
- **Keep downloads active:** Don't break existing file links
- **Monitor closely:** Watch for issues during maintenance
- **Have rollback plan:** Be prepared to quickly revert changes

### Timing

- **Schedule wisely:** Choose low-traffic periods
- **Minimize duration:** Keep maintenance windows short
- **Batch updates:** Combine multiple maintenance tasks
- **Automate when possible:** Use scripts for routine tasks

## Troubleshooting Maintenance Mode

### Common Issues

**Maintenance page not displaying**
- Check web server configuration
- Verify maintenance.php file exists
- Check file permissions

**Downloads not working during maintenance**
- Verify download routes are excluded
- Check file storage permissions
- Test direct file access

**Can't disable maintenance mode**
- Delete maintenance.php file manually
- Check file system permissions
- Use emergency disable methods

**Custom maintenance page not showing**
- Clear view cache: `php artisan view:clear`
- Check template syntax
- Verify file paths

### Emergency Procedures

If something goes wrong during maintenance:

1. **Immediate rollback:**
   ```bash
   php artisan up
   git checkout previous-stable-commit
   php artisan migrate:rollback
   ```

2. **Restore from backup:**
   ```bash
   # Restore database
   mysql database_name < backup.sql
   
   # Restore files
   rsync -av backup/ storage/
   ```

3. **Contact support:**
   - Document the issue
   - Gather error logs
   - Prepare system information