# 7. Troubleshooting Guide

## Common Issues and Solutions

### 1. Upload Issues

#### File Upload Fails

**Symptoms:**
- Upload progress stops at 0%
- "Upload failed" error message
- Files don't appear after upload

**Solutions:**

1. **Check file size limits:**
   ```bash
   # Check PHP limits
   php -i | grep -E "(upload_max_filesize|post_max_size|max_execution_time)"
   
   # Check application limits
   grep MAX_FILE_SIZE .env
   ```

2. **Verify storage permissions:**
   ```bash
   chmod 755 storage/
   chmod 755 storage/app/
   chmod 755 storage/app/uploads/
   ```

3. **Check disk space:**
   ```bash
   df -h
   ```

4. **Review error logs:**
   ```bash
   tail -f storage/logs/laravel.log
   ```

#### Large File Upload Timeout

**Symptoms:**
- Upload fails for files >25MB
- Gateway timeout errors
- Connection reset errors

**Solutions:**

1. **Increase PHP limits:**
   ```ini
   upload_max_filesize = 100M
   post_max_size = 100M
   max_execution_time = 300
   memory_limit = 512M
   ```

2. **Enable chunked uploads:**
   ```env
   CHUNKED_UPLOAD_ENABLED=true
   CHUNK_SIZE_MB=2
   ```

3. **Configure web server timeouts:**
   ```nginx
   # Nginx
   client_max_body_size 100M;
   client_body_timeout 300s;
   ```

### 2. Download Issues

#### Files Not Downloading

**Symptoms:**
- 404 errors on download links
- Files download as 0 bytes
- Download links don't work

**Solutions:**

1. **Check storage link:**
   ```bash
   php artisan storage:link
   ls -la public/storage
   ```

2. **Verify file exists:**
   ```bash
   ls -la storage/app/uploads/
   ```

3. **Check web server configuration:**
   ```apache
   # Apache .htaccess
   RewriteEngine On
   RewriteCond %{REQUEST_FILENAME} !-f
   RewriteRule ^(.*)$ index.php [QSA,L]
   ```

#### Slow Download Speeds

**Symptoms:**
- Downloads are slower than expected
- Timeouts on large files
- Connection drops during download

**Solutions:**

1. **Enable streaming:**
   ```php
   // Check if streaming is enabled in config
   'streaming' => true,
   ```

2. **Optimize web server:**
   ```nginx
   # Nginx optimization
   sendfile on;
   tcp_nopush on;
   tcp_nodelay on;
   ```

3. **Check server resources:**
   ```bash
   htop
   iotop
   ```

### 3. Database Issues

#### Database Connection Failed

**Symptoms:**
- "Database connection failed" error
- 500 internal server error
- Application won't load

**Solutions:**

1. **Verify database credentials:**
   ```env
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=your_database
   DB_USERNAME=your_username
   DB_PASSWORD=your_password
   ```

2. **Test database connection:**
   ```bash
   php artisan tinker
   >>> DB::connection()->getPdo();
   ```

3. **Check database server status:**
   ```bash
   systemctl status mysql
   # or
   systemctl status mariadb
   ```

#### Migration Errors

**Symptoms:**
- Migration fails to run
- Table already exists errors
- Column not found errors

**Solutions:**

1. **Reset migrations (development only):**
   ```bash
   php artisan migrate:fresh
   ```

2. **Run specific migration:**
   ```bash
   php artisan migrate --path=/database/migrations/specific_migration.php
   ```

3. **Check migration status:**
   ```bash
   php artisan migrate:status
   ```

### 4. Performance Issues

#### Slow Page Loading

**Symptoms:**
- Pages take >3 seconds to load
- High server response times
- Timeouts on requests

**Solutions:**

1. **Enable caching:**
   ```bash
   php artisan config:cache
   php artisan route:cache
   php artisan view:cache
   ```

2. **Optimize database queries:**
   ```bash
   php artisan debugbar:publish
   # Enable query logging in .env
   DB_LOG_QUERIES=true
   ```

3. **Check server resources:**
   ```bash
   free -h
   df -h
   top
   ```

#### High Memory Usage

**Symptoms:**
- Out of memory errors
- Server becomes unresponsive
- 500 errors during uploads

**Solutions:**

1. **Increase PHP memory limit:**
   ```ini
   memory_limit = 512M
   ```

2. **Optimize file processing:**
   ```env
   STREAM_UPLOADS=true
   PROCESS_IN_CHUNKS=true
   ```

3. **Monitor memory usage:**
   ```bash
   php -r "echo ini_get('memory_limit').PHP_EOL;"
   ```

### 5. Security Issues

#### Rate Limiting Not Working

**Symptoms:**
- Users can upload unlimited files
- No rate limiting applied
- Abuse not prevented

**Solutions:**

1. **Enable rate limiting:**
   ```env
   RATE_LIMITING=true
   RATE_LIMIT_UPLOADS=10
   RATE_LIMIT_WINDOW=60
   ```

2. **Check middleware:**
   ```bash
   php artisan route:list | grep throttle
   ```

3. **Clear cache:**
   ```bash
   php artisan cache:clear
   ```

#### File Validation Bypassed

**Symptoms:**
- Malicious files uploaded
- Wrong file types accepted
- Security warnings

**Solutions:**

1. **Check validation rules:**
   ```php
   // Verify in UploadController
   'file' => 'required|file|max:102400|mimes:jpg,png,pdf,txt'
   ```

2. **Enable strict validation:**
   ```env
   STRICT_FILE_VALIDATION=true
   SCAN_FILE_CONTENT=true
   ```

3. **Update security rules:**
   ```bash
   php artisan config:clear
   ```

### 6. API Issues

#### API Endpoints Not Working

**Symptoms:**
- 404 errors on API calls
- JSON responses not returned
- Authentication failures

**Solutions:**

1. **Check API routes:**
   ```bash
   php artisan route:list | grep api
   ```

2. **Verify API middleware:**
   ```php
   // Check routes/api.php
   Route::middleware('api')->group(function () {
       // API routes
   });
   ```

3. **Test API endpoints:**
   ```bash
   curl -X POST http://localhost:8000/api/upload \
     -F "file=@test.txt"
   ```

#### CORS Issues

**Symptoms:**
- Cross-origin requests blocked
- Browser console CORS errors
- API calls fail from frontend

**Solutions:**

1. **Configure CORS:**
   ```php
   // config/cors.php
   'allowed_origins' => ['*'],
   'allowed_methods' => ['*'],
   'allowed_headers' => ['*'],
   ```

2. **Install CORS package:**
   ```bash
   composer require fruitcake/laravel-cors
   ```

### 7. Environment-Specific Issues

#### Shared Hosting Problems

**Common Issues:**
- PHP version too old
- Missing extensions
- Permission issues
- Limited resources

**Solutions:**

1. **Check PHP version:**
   ```bash
   php -v
   ```

2. **Request PHP upgrade from host**

3. **Use alternative configurations:**
   ```env
   DB_CONNECTION=sqlite
   CACHE_DRIVER=file
   SESSION_DRIVER=file
   ```

#### Docker Issues

**Common Issues:**
- Container won't start
- Volume mounting problems
- Network connectivity issues

**Solutions:**

1. **Check container logs:**
   ```bash
   docker logs container_name
   ```

2. **Verify volume mounts:**
   ```bash
   docker inspect container_name
   ```

3. **Test network connectivity:**
   ```bash
   docker exec -it container_name ping database
   ```

### 8. Debugging Tools

#### Enable Debug Mode

```env
APP_DEBUG=true
LOG_LEVEL=debug
```

#### Check System Information

```bash
php artisan about
```

#### Monitor Logs

```bash
# Application logs
tail -f storage/logs/laravel.log

# Web server logs
tail -f /var/log/nginx/error.log
tail -f /var/log/apache2/error.log
```

#### Database Debugging

```bash
php artisan tinker
>>> DB::enableQueryLog();
>>> // Run your code
>>> DB::getQueryLog();
```

### 9. Getting Help

#### Before Asking for Help

1. **Check error logs**
2. **Verify system requirements**
3. **Test with minimal configuration**
4. **Document the issue clearly**

#### Information to Provide

- PHP version and extensions
- Database type and version
- Web server configuration
- Error messages (full stack trace)
- Steps to reproduce
- Environment details

#### Support Channels

- GitHub Issues: Report bugs and feature requests
- Documentation: Check for updated guides
- Community Forums: Ask questions and share solutions

### 10. Prevention

#### Regular Maintenance

- Monitor disk space
- Update dependencies
- Review error logs
- Test backups
- Performance monitoring

#### Security Best Practices

- Keep software updated
- Regular security audits
- Monitor for suspicious activity
- Implement proper access controls
- Regular backups