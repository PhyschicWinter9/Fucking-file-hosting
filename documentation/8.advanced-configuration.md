# 8. Advanced Configuration

## Chunk Upload Configuration

### 2MB Chunk Size Implementation

The application uses optimized 2MB chunks for large file uploads, specifically designed for shared hosting environments.

**Benefits:**
- Memory efficient for shared hosting
- Cloudflare compatible
- Reduces server load
- Better error recovery

**Configuration:**
```env
CHUNKED_UPLOAD_ENABLED=true
CHUNK_SIZE_MB=2
MAX_CHUNKS_PER_SESSION=500
CHUNK_TIMEOUT_MINUTES=30
```

### Chunk Processing

```php
// config/upload.php
'chunked' => [
    'enabled' => env('CHUNKED_UPLOAD_ENABLED', true),
    'chunk_size' => env('CHUNK_SIZE_MB', 2) * 1024 * 1024,
    'max_chunks' => env('MAX_CHUNKS_PER_SESSION', 500),
    'timeout' => env('CHUNK_TIMEOUT_MINUTES', 30),
    'cleanup_interval' => 60, // minutes
],
```

## Cleanup and Maintenance

### Automatic Cleanup Cron Jobs

#### Laravel Scheduler Setup

Add this single cron job to your server:

```bash
* * * * * cd /path/to/your/project && php artisan schedule:run >> /dev/null 2>&1
```

#### Scheduled Tasks

The application automatically schedules these cleanup tasks:

```php
// app/Console/Kernel.php
protected function schedule(Schedule $schedule)
{
    // Clean expired files every hour
    $schedule->command('files:cleanup-expired')
             ->hourly()
             ->withoutOverlapping();

    // Clean temporary chunks every 30 minutes
    $schedule->command('chunks:cleanup')
             ->everyThirtyMinutes();

    // Clean old logs weekly
    $schedule->command('logs:cleanup')
             ->weekly();

    // Database optimization daily
    $schedule->command('db:optimize')
             ->daily();
}
```

#### Manual Cleanup Commands

```bash
# Clean expired files
php artisan files:cleanup-expired

# Clean temporary chunks
php artisan chunks:cleanup

# Clean old logs (older than 30 days)
php artisan logs:cleanup --days=30

# Full system cleanup
php artisan system:cleanup
```

### Storage Management

#### File Deduplication

```env
FILE_DEDUPLICATION=true
HASH_ALGORITHM=sha256
DEDUPE_THRESHOLD_MB=1
```

#### Storage Optimization

```php
// config/filesystems.php
'uploads' => [
    'driver' => 'local',
    'root' => storage_path('app/uploads'),
    'url' => env('APP_URL').'/storage/uploads',
    'visibility' => 'private',
    'permissions' => [
        'file' => [
            'public' => 0644,
            'private' => 0600,
        ],
        'dir' => [
            'public' => 0755,
            'private' => 0700,
        ],
    ],
],
```

## Performance Optimization

### Caching Configuration

#### Redis Setup

```env
CACHE_DRIVER=redis
SESSION_DRIVER=redis
QUEUE_CONNECTION=redis

REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379
REDIS_DB=0
```

#### File Caching

```env
CACHE_DRIVER=file
CACHE_PREFIX=filehosting
CACHE_TTL=3600
```

### Database Optimization

#### MySQL Configuration

```sql
-- Optimize for file hosting
SET innodb_buffer_pool_size = 256M;
SET innodb_log_file_size = 64M;
SET max_connections = 100;
SET query_cache_size = 32M;
```

#### Database Indexing

```sql
-- Add indexes for better performance
CREATE INDEX idx_files_expires_at ON files(expires_at);
CREATE INDEX idx_files_created_at ON files(created_at);
CREATE INDEX idx_files_hash ON files(file_hash);
```

### CDN Integration

#### Cloudflare Setup

```env
CDN_ENABLED=true
CDN_URL=https://cdn.yourdomain.com
CDN_ZONE_ID=your_zone_id
CDN_API_TOKEN=your_api_token
```

#### AWS CloudFront

```env
CDN_DRIVER=cloudfront
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key
AWS_DEFAULT_REGION=us-east-1
AWS_CLOUDFRONT_DISTRIBUTION_ID=your_distribution_id
```

## Security Configuration

### Rate Limiting

#### Advanced Rate Limiting

```env
RATE_LIMITING=true
RATE_LIMIT_UPLOADS=10
RATE_LIMIT_DOWNLOADS=60
RATE_LIMIT_API=100
RATE_LIMIT_WINDOW=60
RATE_LIMIT_DECAY=1
```

#### IP-based Limiting

```php
// config/rate-limiting.php
'upload' => [
    'max_attempts' => 10,
    'decay_minutes' => 60,
    'prefix' => 'upload',
],
'download' => [
    'max_attempts' => 60,
    'decay_minutes' => 1,
    'prefix' => 'download',
],
```

### File Security

#### Malware Scanning

```env
MALWARE_SCANNING=true
CLAMAV_ENABLED=true
CLAMAV_SOCKET=/var/run/clamav/clamd.ctl
```

#### Content Validation

```env
STRICT_MIME_VALIDATION=true
CONTENT_SCANNING=true
EXECUTABLE_BLOCKING=true
SCRIPT_BLOCKING=true
```

### Privacy Configuration

#### Anonymous Mode

```env
PRIVACY_MODE=true
IP_LOGGING=false
USER_AGENT_LOGGING=false
REFERRER_LOGGING=false
ANALYTICS_DISABLED=true
```

#### Data Retention

```env
DEFAULT_EXPIRATION_DAYS=1
MAX_EXPIRATION_DAYS=365
PERMANENT_FILES_ALLOWED=false
AUTO_DELETE_EXPIRED=true
```

## Monitoring and Logging

### Application Monitoring

#### Log Configuration

```env
LOG_CHANNEL=stack
LOG_LEVEL=info
LOG_DEPRECATIONS_CHANNEL=null
LOG_STACK=single,daily
```

#### Custom Log Channels

```php
// config/logging.php
'channels' => [
    'uploads' => [
        'driver' => 'daily',
        'path' => storage_path('logs/uploads.log'),
        'level' => 'info',
        'days' => 14,
    ],
    'downloads' => [
        'driver' => 'daily',
        'path' => storage_path('logs/downloads.log'),
        'level' => 'info',
        'days' => 7,
    ],
],
```

### Health Monitoring

#### Health Check Endpoints

```php
// routes/web.php
Route::get('/health', function () {
    return response()->json([
        'status' => 'healthy',
        'timestamp' => now(),
        'services' => [
            'database' => DB::connection()->getPdo() ? 'up' : 'down',
            'storage' => Storage::disk('uploads')->exists('.') ? 'up' : 'down',
            'cache' => Cache::store()->getStore()->ping() ? 'up' : 'down',
        ],
    ]);
});
```

#### Metrics Collection

```env
METRICS_ENABLED=true
METRICS_DRIVER=prometheus
METRICS_ENDPOINT=/metrics
```

## API Configuration

### API Rate Limiting

```php
// config/api.php
'rate_limits' => [
    'upload' => '10:1', // 10 requests per minute
    'download' => '60:1', // 60 requests per minute
    'info' => '100:1', // 100 requests per minute
],
```

### API Authentication (Optional)

```env
API_AUTHENTICATION=false
API_KEY_REQUIRED=false
API_TOKEN_EXPIRY=3600
```

### CORS Configuration

```php
// config/cors.php
'paths' => ['api/*'],
'allowed_methods' => ['*'],
'allowed_origins' => ['*'],
'allowed_origins_patterns' => [],
'allowed_headers' => ['*'],
'exposed_headers' => [],
'max_age' => 0,
'supports_credentials' => false,
```

## Environment-Specific Settings

### Shared Hosting Optimizations

```env
# Memory and execution limits
MEMORY_LIMIT=256M
MAX_EXECUTION_TIME=300
MAX_INPUT_TIME=300

# File handling
STREAM_UPLOADS=true
CHUNK_PROCESSING=true
TEMP_CLEANUP_AGGRESSIVE=true

# Database
DB_CONNECTION=sqlite
CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_CONNECTION=sync
```

### VPS/Dedicated Server

```env
# Higher limits
MEMORY_LIMIT=512M
MAX_EXECUTION_TIME=600

# Advanced features
QUEUE_CONNECTION=redis
CACHE_DRIVER=redis
SESSION_DRIVER=redis

# Background processing
QUEUE_WORKERS=3
HORIZON_ENABLED=true
```

### Docker Configuration

```env
# Container-specific settings
CONTAINER_MODE=true
STORAGE_PATH=/app/storage
UPLOADS_PATH=/app/storage/uploads

# Service discovery
DB_HOST=database
REDIS_HOST=redis
CACHE_DRIVER=redis
```

## Backup Configuration

### Automated Backups

```bash
# Database backup
php artisan backup:database --compress

# File backup
php artisan backup:files --exclude-temp

# Full system backup
php artisan backup:full --encrypt
```

### Backup Storage

```env
BACKUP_ENABLED=true
BACKUP_DRIVER=s3
BACKUP_SCHEDULE=daily
BACKUP_RETENTION_DAYS=30

# S3 Configuration
AWS_BACKUP_BUCKET=your-backup-bucket
AWS_BACKUP_REGION=us-east-1
```

## Troubleshooting Advanced Issues

### Performance Debugging

```bash
# Enable query logging
php artisan debugbar:publish

# Profile memory usage
php artisan profile:memory

# Analyze slow queries
php artisan db:analyze-slow-queries
```

### Cache Debugging

```bash
# Clear all caches
php artisan optimize:clear

# Rebuild caches
php artisan optimize

# Test cache connectivity
php artisan cache:test
```